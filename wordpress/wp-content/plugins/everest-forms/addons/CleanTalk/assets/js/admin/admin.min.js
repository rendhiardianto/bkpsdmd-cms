!function(e){const t={init:function(){e(document).ready((function(){t.bindCleanTalkInit(),e(document).on("click","#everest-forms-clean-talk-save-settings",(function(s){s.preventDefault(),t.saveCleanTalkSettings(e(this))})),e(document).on("click",".everest-forms-warning-text-link",(function(s){e.confirm({title:"",boxWidth:"690px",useBootstrap:!1,content:everest_forms_clean_talk.output,buttons:{formSubmit:{text:"Save Settings",btnClass:"everest-forms-btn everest-forms-btn-primary everest-forms-clean_talk__submit",action:function(){var e=this.$content.find(".everest-forms-clean-talk-access-key").val().trim(),s=this.$content.find(".everest-forms-clean-talk-error-message-container");const a={action:"everest_forms_save_clean_talk_settings",security:everest_forms_clean_talk.security,form_data:{access_key:e},is_clean_talk_enabled:"yes"};return t.sendAjaxRequest(a,s),s.hide(),!1}}},onContentReady:function(){}})})),e(document).on("click",".everest-forms-update-clean-talk-key-button",(function(s){s.preventDefault();var a=e(this).data("access-key");e.confirm({title:"",boxWidth:"690px",useBootstrap:!1,content:everest_forms_clean_talk.output,buttons:{formSubmit:{text:"Save Settings",btnClass:"everest-forms-btn everest-forms-btn-primary everest-forms-clean_talk__submit",action:function(){var e=this.$content.find(".everest-forms-clean-talk-access-key").val().trim(),s=this.$content.find(".everest-forms-clean-talk-error-message-container");const a={action:"everest_forms_save_clean_talk_settings",security:everest_forms_clean_talk.security,form_data:{access_key:e},is_clean_talk_enabled:"yes"};return t.sendAjaxRequest(a,s),s.hide(),!1}}},onContentReady:function(){e(document).find(".everest-forms-clean-talk-access-key").val(a)}})}))}))},bindCleanTalkInit:function(){const s=e("#everest-forms-panel-field-settings-cleantalk");t.cleanTalkToggle(s),e(document).on("change","#everest-forms-panel-field-settings-cleantalk",(function(){t.cleanTalkToggle(e(this))}))},cleanTalkToggle:function(t){e(t).is(":checked")?e(".everest-forms-cleantalk-protection-type, .everest-forms-warning-container").show():e(".everest-forms-cleantalk-protection-type, .everest-forms-warning-container").hide()},saveCleanTalkSettings:function(t){const s=e("#everest-forms-clean-talk-settings-form").find("#everest_forms_recaptcha_cleantalk_access_key").val().trim(),a={action:"everest_forms_save_clean_talk_settings",security:everest_forms_clean_talk.security,form_data:{access_key:s},is_clean_talk_enabled:"yes"},n=t;e.ajax({type:"POST",url:everest_forms_clean_talk.ajax_url,data:a,beforeSend:function(){n.append('<i class="evf-loading evf-loading-active"></i>'),n.attr("disabled",!0),n.css({cursor:"not-allowed",opacity:.5})},success:function(t){n.find(".evf-loading").remove();const s=setInterval((function(){window.onbeforeunload=null,e(window).off("beforeunload")}),500);setTimeout((function(){clearInterval(s)}),5e3);const a=e(document).find(".evf-clean-talk-message").show();a.empty(),a.append(t.data.html),a.removeClass("evf-error-message"),a.removeClass("evf-success-message"),t.success?a.addClass("evf-success-message"):(t.data.error,a.addClass("evf-error-message")),n.attr("disabled",!1),n.css({cursor:"",opacity:1})},error:function(){alert("Error saving settings."),n.val(originalText)}})},sendAjaxRequest:function(t,s){e.ajax({type:"POST",url:everest_forms_clean_talk.ajax_url,data:t,success:function(a){if(s.removeClass("evf-error-message"),s.removeClass("evf-success-message"),a.success){e(document).find(".everest-forms-warning-container").hide();var n=e(document).find(".everest-forms-update-clean-talk-key-button");n.removeClass("everest-forms-hidden"),n.data("access-key",t.form_data.access_key),s.hide(),s.addClass("evf-success-message"),s.html(a.data.html).show()}else("invalid"===a.data.error||"empty"===a.data.error)&&(s.addClass("evf-error-message"),s.html(a.data.html).show())}})}};t.init()}(jQuery);
